<!DOCTYPE html>
<html>

<head>
  <title>View Comments</title>
</head>

<body>

          <table class="table table-hover table-condensed  tableSection" id="incomingMessageTable">
            <thead>
              <tr>
                <th>Topic</th>
                <th>Payload</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>

    <script type="text/javascript">

            // Create a client instance
            client = new Paho.MQTT.Client("mqtt.flespi.io", Number(443),"client1234");
 
            // set callback handlers
            client.onConnectionLost = function (responseObject) {
                console.log("Connection Lost: "+responseObject.errorMessage);
            }
 
            client.onMessageArrived = function (message) {
              console.log("Message Arrived: "+message.payloadString);
              // Insert into History Table
              var table = document.getElementById("incomingMessageTable").getElementsByTagName("tbody")[0];
              var row = table.insertRow(0);
              row.insertCell(0).innerHTML = message.destinationName;
              row.insertCell(1).innerHTML = "<pre>" + safeTagsRegex(message.payloadString) + "</pre>";
            }

            client.onMessageDelivered = function (message) {
              console.log("Message Delivered");
            }
 
            // Called when the connection is made
            function onConnect(){
                console.log("Connected");

                client.subscribe("Comments/#", { qos: Number(1) });
            }
 
            // Connect the client, providing an onConnect callback
            client.connect({
                onSuccess: onConnect,
                useSSL: true,
                userName: "cQI1JKQav1EPaxB1rRy4e08lyNacvB5xfBoO95NuUh9UEyJTd7LgYKrklpmGQf3V",
                password: ""
            });

// Just in case someone sends html
function safeTagsRegex(str) {
  return str.replace(/&/g, "&amp;").replace(/</g, "&lt;").
    replace(/>/g, "&gt;");
}

    </script>

</body>

</html>
